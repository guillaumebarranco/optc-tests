<div class="header">
  <h1>
    <input [(ngModel)]="tierListTitle" />
  </h1>

  <div class="languages">
    <button
      mat-button
      [ngClass]="{ active: language === 'FR' }"
      (click)="changeLanguage('FR')"
    >
      FR
    </button>
    <button
      mat-button
      [ngClass]="{ active: language === 'EN' }"
      (click)="changeLanguage('EN')"
    >
      EN
    </button>
  </div>
</div>

<ul class="nav">
  <ng-container *ngFor="let tierList of tierLists; let tierIndex = index">
    <li
      *ngIf="tierIndex < 5"
      [ngClass]="{ active: _currentTierIndex === tierIndex }"
      (click)="switchTierList(tierIndex)"
    >
      <span *ngIf="language === 'FR'"> {{ tierList.frenchName }}</span>
      <span *ngIf="language === 'EN'"> {{ tierList.englishName }}</span>
    </li>
  </ng-container>

  <li>
    <span *ngIf="language === 'FR'">Autres</span>
    <span *ngIf="language === 'EN'">Others</span>

    <ul>
      <ng-container *ngFor="let tierList of tierLists; let tierIndex = index">
        <li
          *ngIf="tierIndex > 4"
          [ngClass]="{ active: _currentTierIndex === tierIndex }"
          (click)="switchTierList(tierIndex)"
        >
          <span *ngIf="language === 'FR'"> {{ tierList.frenchName }}</span>
          <span *ngIf="language === 'EN'"> {{ tierList.englishName }}</span>
        </li>
      </ng-container>
    </ul>
  </li>
</ul>

<div class="container">
  <app-tier-list-actions
    class="actions-list"
    [hidden]="!showActions"
    [tierListTitle]="tierListTitle"
    [tiers]="tiers"
    [removedCharacters]="removedCharacters"
    [showRemovedCharacters]="showRemovedCharacters"
    [language]="language"
    (toggleShowRemovedCharacters)="onToggleShowRemovedCharacters($event)"
    (loadTierList)="onLoadTierList($event)"
    (exportTierList)="onExportTierList($event)"
  ></app-tier-list-actions>

  <div [hidden]="!showFilters">
    <!-- <button mat-button>Hide Legends 6+ version</button> -->
    <!-- <button mat-button>
      Hide Legends 6 stars version when legend also have a 6+ version
    </button> -->

    <div *ngIf="language === 'FR'">Pour les légendes uniquement</div>
    <div *ngIf="language === 'EN'">For legends only</div>

    <br />

    <mat-form-field appearance="fill">
      <mat-label *ngIf="language === 'FR'">Année de sortie</mat-label>
      <mat-label *ngIf="language === 'EN'">Debut Year Selection</mat-label>

      <mat-select
        name="year-selection"
        [ngModel]="_filters.selectedYearLegend"
        (ngModelChange)="updateYearSelection($event)"
      >
        <mat-option *ngIf="language === 'FR'" value="none">Aucune</mat-option>
        <mat-option *ngIf="language === 'EN'" value="none">None</mat-option>
        <mat-option value="2015">2015</mat-option>
        <mat-option value="2016">2016</mat-option>
        <mat-option value="2017">2017</mat-option>
        <mat-option value="2018">2018</mat-option>
        <mat-option value="2019">2019</mat-option>
        <mat-option value="2020">2020</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <br />

  <div id="download" style="visibility: hidden; height: 0">
    <img #canvas />
    <a #downloadLink></a>
  </div>

  <div cdkDropListGroup>
    <table #screen>
      <tbody>
        <ng-container *ngFor="let tier of tiers; let i = index">
          <tr *ngIf="i !== 6 || !hideLastTier">
            <td class="labelHolder" contenteditable="false">
              <input
                [ngStyle]="{ 'background-color': colors[i] }"
                [(ngModel)]="tier.name"
              />
            </td>
            <td
              cdkDropList
              [cdkDropListData]="tier.characters"
              (cdkDropListDropped)="drop($event)"
            >
              <div class="tier sort" id="rows">
                <ng-container *ngFor="let character of tier.characters">
                  <ng-container *ngIf="i !== 6">
                    <img
                      [src]="_getCharacterImgPath(character)"
                      [ngStyle]="_getImgStyleFormFiltering(character.id)"
                      width="64"
                      alt=""
                      cdkDrag
                      [cdkDragData]="character"
                    />
                  </ng-container>

                  <ng-container *ngIf="i === 6">
                    <img
                      [src]="_getCharacterImgPath(character)"
                      [ngStyle]="_getImgStyleFormFiltering(character.id)"
                      width="64"
                      (contextmenu)="removeCharacterFromTier(tier, character)"
                      cdkDrag
                      [cdkDragData]="character"
                    />
                  </ng-container>
                </ng-container>

                <ng-container *ngIf="showRemovedCharacters && i === 6">
                  <img
                    *ngFor="let character of removedCharacters"
                    class="removed-character"
                    [src]="_getCharacterImgPath(character)"
                    width="64"
                    (contextmenu)="putCharacterBackInTier(tier, character)"
                  />
                </ng-container>
              </div>
            </td></tr
        ></ng-container>
      </tbody>
    </table>
  </div>
</div>

<div class="fixed-buttons">
  <button
    mat-icon-button
    [ngClass]="{ active: showActions }"
    (click)="showActions = !showActions"
  >
    <mat-icon>settings</mat-icon>
  </button>

  <button
    mat-icon-button
    [ngClass]="{ active: showFilters }"
    (click)="showFilters = !showFilters"
  >
    <mat-icon>filter_list</mat-icon>
  </button>

  <button mat-icon-button (click)="showInformationsDialog()">
    <mat-icon>info</mat-icon>
  </button>
</div>
